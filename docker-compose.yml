name: releasecraft

services:
  mongo:
    image: mongo:6.0
    container_name: mongo
    restart: unless-stopped
    ports:
      - '27017:27017'
    environment:
      - MONGO_INITDB_DATABASE=almdb
    volumes:
      - ./mongodb_data:/data/db
      - ./mongodb_config:/data/configdb
    networks:
      - releasecraft-network

  mock-alm:
    build: ./mock_alm
    container_name: mock-alm
    restart: unless-stopped
    ports:
      - '8001:8001'
    environment:
      - PYTHONUNBUFFERED=1
    networks:
      - releasecraft-network

  backend:
    build: ./backend
    container_name: backend
    restart: unless-stopped
    ports:
      - '8000:8000'
    environment:
      - MONGO_URI=mongodb://mongo:27017/almdb
      - CORS_ORIGINS=http://localhost:5173
      - USE_MOCK_ALM=true
      - ALM_BASE_URL=http://mock-alm:8001
      - ALM_ENCRYPTION_KEY=${ALM_ENCRYPTION_KEY:-}
    env_file:
      - ./backend/.env.local
    depends_on:
      - mock-alm
    networks:
      - releasecraft-network

  frontend:
    build: ./frontend
    container_name: frontend
    restart: unless-stopped
    ports:
      - '5173:80'
    depends_on:
      - backend
    networks:
      - releasecraft-network

networks:
  releasecraft-network:
    driver: bridge
volumes:
  mongo_data:
